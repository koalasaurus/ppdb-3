<!DOCTYPE html>
<html>
<head>
    <title>Dashboard User</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/user.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        // Fungsi untuk menyembunyikan notifikasi
        function closeNotification() {
            const notification = document.getElementById('notification');
            notification.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const progress = {{ progress }};
            const circle = document.getElementById('circularProgress');
            if (circle) {
                circle.style.background = `conic-gradient(#6c63ff ${progress * 3.6}deg, #e0e7ff ${progress * 3.6}deg 360deg)`;
            }
        });
    </script>
</head>
<body>
    <!-- Notifikasi -->
    {% if notification %}
    <div id="notification" class="notification {{ 'success' if 'diterima' in notification.message.lower() else 'error' }}">
        <button class="close-btn" onclick="closeNotification()">×</button>
        {{ notification.message }}
    </div>
    {% endif %}

    <div class="container">
        <h1>Dashboard User</h1>
        <p>Selamat datang, <strong>{{ user.name }}</strong>! Berikut adalah informasi seputar PPDB dan progres pendaftaran Anda.</p>

        <div class="circular-progress-container">
            <div class="circular-progress" id="circularProgress">
                <span class="progress-value" id="progressValue">{{ progress }}%</span>
            </div>
            <div class="progress-label-circular">Progres Pendaftaran</div>
        </div>

        <h2>Checklist Pendaftaran</h2>
        <ul class="checklist-list">
            <li>
                Nama
                <span class="status {{ 'complete' if user.name else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.name else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Email
                <span class="status {{ 'complete' if user.email else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.email else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Alamat
                <span class="status {{ 'complete' if user.address else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.address else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Asal Sekolah
                <span class="status {{ 'complete' if user.school else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.school else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Hobi
                <span class="status {{ 'complete' if user.hobby else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.hobby else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Nama Orang Tua/Wali
                <span class="status {{ 'complete' if user.parent_name else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.parent_name else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Pekerjaan Orang Tua/Wali
                <span class="status {{ 'complete' if user.parent_job else 'incomplete' }}">
                    {{ '✔ Sudah diisi' if user.parent_job else '✘ Belum diisi' }}
                </span>
            </li>
            <li>
                Ijazah
                <span class="status {{ 'complete' if user.ijazah_confirmed else 'incomplete' }}">
                    {{ '✔ Sudah dikonfirmasi' if user.ijazah_confirmed else '✘ Belum dikonfirmasi' }}
                </span>
            </li>
            <li>
                Kartu Keluarga
                <span class="status {{ 'complete' if user.kk_confirmed else 'incomplete' }}">
                    {{ '✔ Sudah dikonfirmasi' if user.kk_confirmed else '✘ Belum dikonfirmasi' }}
                </span>
            </li>
            <li>
                Pembayaran
                <span class="status {{ 'complete' if user.payment_status == 'Approved' else 'incomplete' }}">
                    {% if user.payment_status == 'Approved' %}
                        ✔ Sudah dikonfirmasi
                    {% elif user.payment_status == 'Pending' %}
                        ✘ Menunggu konfirmasi
                    {% else %}
                        ✘ Belum ada pembayaran
                    {% endif %}
                </span>
            </li>
        </ul>

        <h2>Status Pembayaran</h2>
        <p>
            {% if user.payment_status == 'Pending' %}
                Menunggu konfirmasi admin.
            {% elif user.payment_status == 'Approved' %}
                ✔ Pembayaran telah diterima.
            {% elif user.payment_status == 'Rejected' %}
                ✘ Pembayaran ditolak. Silakan unggah ulang bukti pembayaran.
            {% else %}
                Belum ada pembayaran.
            {% endif %}
        </p>
        {% if user.payment_status == 'Rejected' or user.payment_status is none %}
            <a href="{{ url_for('payment', user_id=user.id) }}" class="btn-payment">Unggah Bukti Pembayaran</a>
        {% else %}
            <a href="{{ url_for('payment', user_id=user.id) }}" class="btn-payment">Unggah Bukti Pembayaran</a>
        {% endif %}

        <h2>Aksi</h2>
        <a href="{{ url_for('form', user_id=user.id) }}" class="btn-formulir">Isi Formulir</a>
    </div>
</body>
</html>